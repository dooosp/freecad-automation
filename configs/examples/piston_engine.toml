# Piston Engine (Crank-Slider Mechanism) — Horizontal layout
# Demonstrates: crankshaft (revolute) → connecting rod (floating) → piston (prismatic)
# Crank rotates 360° → piston reciprocates via crank-slider kinematics.
#
# Geometry (XY plane, Z=depth):
#   Crankshaft center at [20, 30]
#   Crank radius = 15mm, rod length = 50mm
#   At TDC (θ=0): crank pin at [35, 30], piston at x = 20+15+50 = 85
#   Piston slides along X axis (horizontal)
#   Piston stroke = 2 × crank_r = 30mm  (range: x=55 to x=85)

name = "piston_engine"

[export]
formats = ["step", "stl"]
directory = "./output"
per_part_stl = true


# ═══════════════════════════════════════════════════
# PART DEFINITIONS
# ═══════════════════════════════════════════════════

# ── 1. Base plate ───────────────────────────────
[[parts]]
id = "base"
  [[parts.shapes]]
  id = "plate"
  type = "box"
  length = 100
  width = 60
  height = 8

# ── 2. Crankshaft ─────────────────────────────────
[[parts]]
id = "crankshaft"
  [[parts.shapes]]
  id = "main"
  type = "cylinder"
  radius = 6
  height = 30

# ── 3. Crank arm (length = 2×crank_r = 30mm) ────
[[parts]]
id = "crank_arm"
  [[parts.shapes]]
  id = "arm"
  type = "box"
  length = 30
  width = 8
  height = 8

# ── 4. Connecting rod (length = 50mm) ────────────
[[parts]]
id = "con_rod"
  [[parts.shapes]]
  id = "rod"
  type = "box"
  length = 50
  width = 8
  height = 8

# ── 5. Piston ────────────────────────────────────
[[parts]]
id = "piston"
  [[parts.shapes]]
  id = "head"
  type = "cylinder"
  radius = 12
  height = 15


# ═══════════════════════════════════════════════════
# ASSEMBLY
# ═══════════════════════════════════════════════════

[assembly]

[[assembly.parts]]
ref = "base"
position = [0, 0, 0]

[[assembly.parts]]
ref = "crankshaft"
position = [20, 30, 8]

# Crank arm: pivot at crankshaft center [20, 30], horizontal at θ=0
[[assembly.parts]]
ref = "crank_arm"
position = [5, 26, 24]

# Connecting rod: big end at crank pin [35, 30] at TDC, extends right to piston
[[assembly.parts]]
ref = "con_rod"
position = [35, 26, 24]

# Piston: at TDC position (x = 20 + 15 + 50 = 85)
[[assembly.parts]]
ref = "piston"
position = [85, 30, 24]


# ── Joints with explicit anchors ──────────────────

[[assembly.joints]]
id = "crank_rev"
type = "revolute"
part = "crank_arm"
axis = [0, 0, 1]
anchor = [20, 30, 24]      # crankshaft center

[[assembly.joints]]
id = "rod_rev"
type = "revolute"
part = "con_rod"
axis = [0, 0, 1]
anchor = [35, 30, 24]      # crank pin at TDC (20+15, 30)

[[assembly.joints]]
id = "piston_prism"
type = "prismatic"
part = "piston"
axis = [1, 0, 0]           # piston slides along X (horizontal)
anchor = [85, 30, 24]      # piston center at TDC


# ── Motion (Crank-Slider) ────────────────────────

[assembly.motion]
driver = "crank_rev"
range = [0, 720]      # 2 full revolutions
duration = 3.0
steps = 120
loop = true
linkage = "crank_slider"

[assembly.motion.linkage_params]
crank_r = 15           # crank throw radius (mm)
rod_length = 50        # connecting rod length (mm)
piston_joint = "piston_prism"
rod_joint = "rod_rev"
origin = [20, 30, 24]  # crankshaft center in 3D
