# Four-Bar Linkage Mechanism
# Demonstrates: 4 bars + 4 revolute joints + Grashof-compliant linkage solver
# Crank rotates 360° → coupler and rocker follow via closed-loop kinematics.
#
# Grashof condition (s+l < p+q): 20+60 < 50+45 → 80 < 95 ✓ (crank-rocker)

name = "four_bar_linkage"

[export]
formats = ["step", "stl"]
directory = "./output"
per_part_stl = true


# ═══════════════════════════════════════════════════
# PART DEFINITIONS
# ═══════════════════════════════════════════════════

# ── 1. Ground frame ───────────────────────────────
[[parts]]
id = "ground"
  [[parts.shapes]]
  id = "bar"
  type = "box"
  length = 60
  width = 8
  height = 5

# ── 2. Crank (shortest bar = s = 20) ─────────────
[[parts]]
id = "crank"
  [[parts.shapes]]
  id = "bar"
  type = "box"
  length = 20
  width = 6
  height = 5

# ── 3. Coupler (longest bar = l = 50) ────────────
[[parts]]
id = "coupler"
  [[parts.shapes]]
  id = "bar"
  type = "box"
  length = 50
  width = 6
  height = 5

# ── 4. Rocker (bar = 45) ─────────────────────────
[[parts]]
id = "rocker"
  [[parts.shapes]]
  id = "bar"
  type = "box"
  length = 45
  width = 6
  height = 5


# ═══════════════════════════════════════════════════
# ASSEMBLY
# ═══════════════════════════════════════════════════

[assembly]

[[assembly.parts]]
ref = "ground"
position = [0, 0, 0]

[[assembly.parts]]
ref = "crank"
position = [0, 0, 6]

[[assembly.parts]]
ref = "coupler"
position = [20, 0, 12]

[[assembly.parts]]
ref = "rocker"
position = [60, 0, 6]


# ── Joints ────────────────────────────────────────

# Crank pivot at origin (ground-crank)
[[assembly.joints]]
id = "crank_rev"
type = "revolute"
part = "crank"
axis = [0, 0, 1]

# Coupler pivot at crank end
[[assembly.joints]]
id = "coupler_rev"
type = "revolute"
part = "coupler"
axis = [0, 0, 1]

# Rocker pivot at ground end (x=60)
[[assembly.joints]]
id = "rocker_rev"
type = "revolute"
part = "rocker"
axis = [0, 0, 1]


# ── Motion (Linkage-based) ────────────────────────

[assembly.motion]
driver = "crank_rev"
range = [0, 360]
duration = 3.0
steps = 90
loop = true
linkage = "four_bar"

[assembly.motion.linkage_params]
a = 20   # crank
b = 50   # coupler
c = 45   # rocker
d = 60   # ground
coupler_joint = "coupler_rev"
rocker_joint = "rocker_rev"
